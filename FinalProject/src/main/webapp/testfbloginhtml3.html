<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    


        <div>
                Facebook登入：<input type="button"  value="Facebook登入" onclick="FBLogin();" />
        </div>





            <script type="text/javascript">
                //應用程式編號，進入 https://developers.facebook.com/apps/ 即可看到
                let FB_appID = "301951257305688";
        
                //FB Login 官方文件：https://developers.facebook.com/docs/facebook-login/web
        
                // Load the Facebook Javascript SDK asynchronously
                (function (d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0];
                    if (d.getElementById(id)) return;
                    js = d.createElement(s); js.id = id;
                    js.src = "https://connect.facebook.net/en_US/sdk.js";
                    fjs.parentNode.insertBefore(js, fjs);
                }(document, 'script', 'facebook-jssdk'));
        
                window.fbAsyncInit = function () {
                    FB.init({
                        appId: "301951257305688",//FB appID
                        cookie: true,  // enable cookies to allow the server to access the session
                        
                        xfbml: true,  // parse social plugins on this page
                        version: 'v3.2' // use graph api version
                    });
        
                };
        
                //使用自己客製化的按鈕來登入
                function FBLogin() {
                    
                    FB.login(function (response) {
                        FB.api('/me?fields=name,first_name,last_name,email', function(response) { 
                //将用户信息传回服务端
//     	        	window.location.href="TestFBLogin.do?userInfo="+JSON.stringify(response);

                 $.ajax({
                        type:"POST",
                        url:"processFacebookLogin",
                        data:{
                            userInfo:JSON.stringify(response)
                        },
                        dataType:"json",
                        // async:false,
                        success:function(response){
                            alert("這裡是facebook的登入:"+response)
                            if(response=="userFBLonin"){
                                var Days = 30;//cookie設定30天
                                var exp = new Date();
                                exp.setTime(exp.getTime() + Days*24*60*60*1000);
                                document.cookie = "email=" + response+";expires=" + exp.toGMTString();
                                alert('facebook登入+把email塞到cookie裡面');
                                window.location.href = "http://localhost:8080/FinalProject/FirstPage.html";
                                window.location.href="http://localhost:8090/FinalProject/git/repository/FinalProject/src/main/webapp/FirstPage.html";
                            }else{
                                alert("facebook登入失敗")
                                // window.location.href="https://tw.yahoo.com/?p=us";
                            }
                        }
                    });
                // document.getElementById('status').innerHTML =
                //     'Thanks for logging in, ' + response.name + '!';
            });
                    }, { scope: 'public_profile,email' });
        
                }
            </script>
</body>
</html>